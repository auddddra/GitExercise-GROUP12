<!--inherits from base.html-->
{% extends "base.html" %}

{% block body %}
<div class="header-section">
    <h1>Museum of Hearts</h1>
    <p>memories and untold feelings at every spot in Multimedia University</p>

    <div class="header-actions">
        <form method="GET" action="{{ url_for('index') }}" class="search-form">
            <input type="search" name="q" placeholder="Search name or place..." value="{{ request.args.get('q', '') }}">
            <button type="submit">üîç</button>
        </form>

        <a href="{{ url_for('create') }}" class="btn-outline"> üíå Tell us your story</a>
    </div>
</div>

<div id="map">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</div>

<script>
    var map = L.map('map').setView([2.9273, 101.6415], 16);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    function addMarker(lat, lng, label) {
      L.marker([lat, lng]).addTo(map)
        .bindPopup("<b>" + label + "</b><br>(" + lat.toFixed(5) + ", " + lng.toFixed(5) + ")");
    }

    // Save pins locally in browser
    var pins = JSON.parse(localStorage.getItem("pins")) || [];

    // Load existing pins
    pins.forEach(pin => addMarker(pin.lat, pin.lng, pin.label));

    // Add new pin on click
    map.on('contextmenu', function(e) {
    var label = prompt("Enter a label for your pin:");
    if (label) {
        // Add marker to map
        L.marker([e.latlng.lat, e.latlng.lng]).addTo(map)
            .bindPopup("<b>" + label + "</b><br>(" + e.latlng.lat.toFixed(5) + ", " + e.latlng.lng.toFixed(5) + ")");

        // Save to backend
        fetch("/api/pins", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lat: e.latlng.lat, lng: e.latlng.lng, label: label })
        })
        .then(res => res.json())
        .then(data => console.log("Pin saved:", data))
        .catch(err => console.error("Error saving pin:", err));
    }
    });

    // Example fixed marker: MMU Main Entrance
    L.marker([2.9273, 101.6415]).addTo(map)
      .bindPopup("<b>MMU Cyberjaya</b><br>Main Entrance").openPopup();

    fetch("/api/pins")
    .then(res => res.json())
    .then(pins => {
        pins.forEach(pin => {
            L.marker([pin.lat, pin.lng]).addTo(map)
                .bindPopup("<b>" + pin.label + "</b>");
        });
    });


</script>


<div class="gallery">
    <!-- Demo card 1 -->
    <div class="card">
        <h3>To: Aisyah</h3>
        <h4 class="location">The Bridge Near FOM</h4>
        <p class="message">I always stopped here after class with my best friend.  
        It felt like time froze for a moment.</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/5k38wzpLb15YgncyWdTZE4" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 2 -->
    <div class="card">
        <h3>To: Melissa</h3>
        <h4 class="location">The Library Steps</h4>
        <p class="message">Where I met you for the first time.  
        Every time I pass by, this song plays in my head:</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/0tgVpDi06FyKpA1z0VMD4v" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 3 -->
    <div class="card">
        <h3>To: Adrianna</h3>
        <h4 class="location">The Lake</h4>
        <p class="message">I used to sit here every evening, watching the sunset.  
        It was my safe place during stressful days.</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/3ZCTVFBt2Brf31RLEnCkWJ" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 4 -->
    <div class="card">
        <h3>To: Hafiz</h3>
        <h4 class="location">Cafeteria Corner</h4>
        <p class="message">The spot where laughter was louder than anything.  
        I‚Äôll always remember our nasi lemak mornings.</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/0VjIjW4GlUZAMYd2vXMi3b" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 5 -->
    <div class="card">
        <h3>To: Him</h3>
        <h4 class="location">FCM</h4>
        <p class="message">I think about it somethimes, it was a nice memory</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/4uLU6hMCjMI75M1A2tKUQC" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 6 -->
    <div class="card">
        <h3>To: I dont like you</h3>
        <h4 class="location">Deens Cafe</h4>
        <p class="message">I never want it to happen ever again, its over</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/3ZCTVFBt2Brf31RLEnCkWJ" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 7 -->
    <div class="card">
        <h3>To: The FCA girl</h3>
        <h4 class="location">FCM Cinema</h4>
        <p class="message">Meeting you was one of my best memories, 
            thank you for making my foundation life liveable</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/7ouMYWpwJ422jRcDASZB7P" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>

    <!-- Demo card 8 -->
    <div class="card">
        <h3>To: Mika </h3>
        <h4 class="location">Haji Tapah</h4>
        <p class="message">You are a good man bro, have a blessed life</p>
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/track/1AhDOtG9vPSOmsWgNW0BEY" 
            width="100%" height="80" frameborder="0" 
            allowtransparency="true" allow="encrypted-media">
        </iframe>
    </div>
</div>
{% endblock %}


{% block footer %}
<div class="footer">
    <a href="{{ url_for('contacts') }}" target="_self">Contact us for help</a>
</div>
{% endblock %}